{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=sports" />
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

    {% block fileStyle %}

    {% endblock %}
</head>

<body>

    <div class="top-side d-flex flex-row">
        <!-- Sidebar (lg+) -->
        <div class="sidebar d-flex flex-column justify-content-between p-3 position-sticky d-none d-lg-flex">
            <div>
                <div class="academy-logo d-flex align-items-center gap-2 mb-4">
                    <div class="logo-icon d-flex justify-content-center align-items-center">
                        <span
                            class="material-symbols-outlined fs-4 bg-success px-2 rounded-2 text-light p-2">sports</span>
                    </div>
                    <div>
                        <h6 class="mb-0 fw-bold text-truncate" style="max-width: 150px;">
                            {{ trainer.academy_name|default:"Academy" }}
                        </h6>
                        <div class="d-flex align-items-center gap-1">
                            <span class="badge bg-success-subtle text-success">Professional Plan</span>
                            <i class="bi bi-award text-success"></i>
                        </div>
                    </div>
                </div>

                {% url 'trainers:overview_view' as overview_view_url %}
                {% url 'trainers:students_view' as students_view_url %}
                {% url 'trainers:training_sessions_view' as training_sessions_view_url %}
                {% url 'trainers:attendance_view'  as attendance_view_url %}
                {% url 'trainers:evaluations_view' as evaluations_view_url %}
                {% url 'communication:trainer_conversations_view' as trainer_conversations_view_url %}


                <ul class="nav flex-column">
                    <li class="nav-item"><a href="{% url 'trainers:overview_view' %}" class="nav-link {% if request.path == overview_view_url %} active{% endif %}"><i class="bi bi-speedometer2 me-2"></i>Overview</a></li>
                    <li class="nav-item"><a href="{% url 'trainers:students_view' %}" class="nav-link {% if request.path == students_view_url %} active{% endif %}"><i class="bi bi-journal-text me-2"></i>My Students</a></li>
                    <li class="nav-item"><a href="{% url 'trainers:training_sessions_view' %}" class="nav-link {% if request.path == training_sessions_view_url %} active{% endif %}"><i class="bi bi-people me-2"></i>Sessions</a></li>
                    <li class="nav-item"><a href="{% url 'trainers:attendance_view' %}" class="nav-link {% if request.path == 'attendance_view_url' %} active{% endif %}"><i class="bi bi-calendar-check me-2"></i>Attendance</a></li>
                    <li class="nav-item"><a href="{% url 'trainers:evaluations_view' %}" class="nav-link {% if request.path == evaluations_view_url %} active{% endif %}"><i class="bi bi-person-badge me-2"></i>Evaluations</a></li>
                    <li class="nav-item">
                    <a href="{% url 'communication:trainer_conversations_view' %}" class="nav-link {% if request.path == trainer_conversations_view_url %} active{% endif %}">
                        <i class="bi bi-chat-dots me-2"></i>Messages
                    </a>
                    </li>
                </ul>
            </div>

            <!-- User dropup -->
            <div class="dropdown mt-4">
                <button class="btn w-100 d-flex align-items-center p-2 rounded user-info-btn" type="button"
                    id="userMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                    <div class="rounded-circle d-flex justify-content-center align-items-center me-2"
                        style="width:40px;height:40px;background:#2eaf7d;color:#fff;font-weight:bold;flex-shrink:0;">
                        {% if trainer.profile_image %}
                        <img src="{{ trainer.profile_image.url }}" alt="Profile" class="rounded-circle"
                            style="width:40px;height:40px;object-fit:cover;">
                        {% else %}
                        {{ trainer.name|first|upper }}
                        {% endif %}
                    </div>
                    <div class="text-start">
                        <strong>{{ trainer.name }}</strong><br>
                        <small class="text-muted">{{ user.email }}</small>
                    </div>
                </button>

                <ul class="dropdown-menu shadow" aria-labelledby="userMenuButton" style="min-width:220px;">
                    <li><a class="dropdown-item d-flex align-items-center" href="{% url 'accounts:trainer_profile_view' %}"><i class="bi bi-person me-2"></i>
                            Profile Settings</a></li>
                    <li><a class="dropdown-item d-flex align-items-center" href=""><i class="bi bi-bell me-2"></i>
                            Notifications</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item text-danger d-flex align-items-center"
                            href="{% url 'accounts:log_out' %}">
                            <i class="bi bi-box-arrow-right me-2"></i> Sign out</a></li>
                </ul>
            </div>
        </div>

        <!-- Right side -->
        <div class="right-father d-flex flex-column">
            <!-- Topbar -->
            <div class="topbar position-sticky">
                <div class="d-flex align-items-center">
                    <button class="btn d-lg-none me-2" type="button" data-bs-toggle="offcanvas"
                        data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas">
                        <i class="bi bi-list fs-3"></i>
                    </button>
                    <h4 class="mb-0">{% block page_title %}Dashboard{% endblock %}</h4>
                </div>
                <div>
                    <a href="/" class="btn btn-success text-white d-none d-sm-inline-flex">
                        <i class="bi bi-box-arrow-right me-1"></i> Back to Site
                    </a>
                    <a href="/" class="btn btn-success text-white btn-sm d-inline-flex d-sm-none">
                        <i class="bi bi-box-arrow-right"></i>
                    </a>
                </div>
            </div>

            <!-- Content -->
            <main>
               {% if messages and not hide_django_messages %}
                <div class="messages">
                    {% for message in messages %}
                    <div class="alert {% if 'error' in message.tags or 'danger' in message.tags %}alert-danger{% elif 'success' in message.tags %}alert-success{% else %}alert-info{% endif %} alert-dismissible fade show"
                        role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}


                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

    <!-- Offcanvas (sm-) -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">{{ trainer.academy_name|default:"Academy" }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body d-flex flex-column justify-content-between">
            <div>
                <ul class="nav flex-column">
                    <li class="nav-item"><a href="{% url 'trainers:overview_view' %}" class="nav-link {% if request.path == overview_view_url %} active{% endif %}"><i class="bi bi-speedometer2 me-2"></i>Overview</a></li>
                    <li class="nav-item"><a href="{% url 'trainers:students_view' %}" class="nav-link {% if request.path == students_view_url %} active{% endif %}"><i class="bi bi-journal-text me-2"></i>My Students</a></li>
                    <li class="nav-item"><a href="{% url 'trainers:training_sessions_view' %}" class="nav-link {% if request.path == training_sessions_view_url %} active{% endif %}"><i class="bi bi-people me-2"></i>Sessions</a></li>
                    <li class="nav-item"><a href="{% url 'trainers:attendance_view' %}" class="nav-link {% if request.path == attendance_view_url %} active{% endif %}"><i class="bi bi-calendar-check me-2"></i>Attendance</a></li>
                    <li class="nav-item"><a href="{% url 'trainers:evaluations_view' %}" class="nav-link {% if request.path == evaluations_view_url %} active{% endif %}"><i class="bi bi-person-badge me-2"></i>Evaluations</a></li>
                    <li class="nav-item">
                    <a href="{% url 'communication:trainer_conversations_view' %}" class="nav-link {% if request.path == trainer_conversations_view_url %} active{% endif %}">
                        <i class="bi bi-chat-dots me-2"></i>Messages
                    </a>
                    </li>
                </ul>
            </div>

            <div class="dropdown mt-4">
                <button class="btn w-100 d-flex align-items-center p-2 rounded user-info-btn" type="button"
                    id="userMenuButtonMobile" data-bs-toggle="dropdown" aria-expanded="false">
                    <div class="rounded-circle d-flex justify-content-center align-items-center me-2"
                        style="width:40px;height:40px;background:#2eaf7d;color:#fff;font-weight:bold;flex-shrink:0;">
                        {% if trainer.profile_image %}
                        <img src="{{ trainer.profile_image.url }}" alt="Profile" class="rounded-circle"
                            style="width:40px;height:40px;object-fit:cover;">
                        {% else %}
                        {{ trainer.name|first|upper }}
                        {% endif %}
                    </div>
                    <div class="text-start">
                        <strong>{{ trainer.name }}</strong><br>
                        <small class="text-muted">{{ user.email }}</small>
                    </div>
                </button>

                <ul class="dropdown-menu shadow" aria-labelledby="userMenuButtonMobile" style="min-width:220px;">
                    <li><a class="dropdown-item d-flex align-items-center" href="{% url 'accounts:trainer_profile_view' %}"><i class="bi bi-person me-2"></i>
                            Profile Settings</a></li>
                    <li><a class="dropdown-item d-flex align-items-center" href="#"><i class="bi bi-bell me-2"></i>
                            Notifications</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item text-danger d-flex align-items-center" href="{% url 'accounts:log_out' %}"> <i class="bi bi-box-arrow-right me-2"></i> Sign out</a></li>
                </ul>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>